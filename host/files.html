<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AlliFF Bot Manager - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --primary: #00d4ff;
      --primary-dark: #0099cc;
      --gradient: linear-gradient(135deg, #00d4ff 0%, #0088ff 50%, #0066cc 100%);
      --bg: #05060a;
      --card-bg: rgba(12, 17, 29, 0.9);
      --text: #ffffff;
      --text-muted: #a0aec0;
      --success: #00ff88;
      --error: #ff5555;
      --warning: #ffaa00;
    }
    
    body {
      font-family: 'Tajawal', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 30px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 3px solid var(--primary);
      position: sticky; top: 0; z-index: 1000;
    }
    
    .logo { font-size: 24px; font-weight: 900; background: var(--gradient); -webkit-background-clip: text; background-clip: text; color: transparent; }
    
    .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
    
    .manage-card { background: var(--card-bg); border-radius: 15px; padding: 25px; border: 2px solid rgba(0, 212, 255, 0.2); }
    
    .manage-card-title { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
    
    .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.3s; font-family: 'Tajawal', sans-serif; text-decoration: none; display: inline-block; text-align: center; }
    
    .btn-primary { background: var(--gradient); color: #000; }
    .btn-back { background: rgba(255, 255, 255, 0.1); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2); }
    .btn-manage { background: rgba(0, 212, 255, 0.1); color: var(--primary); border: 1px solid var(--primary); }
    .btn-danger { background: rgba(255, 85, 85, 0.1); color: var(--error); border: 1px solid var(--error); }
    .btn-warning { background: rgba(255, 170, 0, 0.1); color: var(--warning); border: 1px solid var(--warning); }
    
    .file-list { background: rgba(0, 0, 0, 0.3); border-radius: 10px; margin-top: 20px; overflow: hidden; }
    
    .file-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
    .file-item:hover { background: rgba(0, 212, 255, 0.05); }
    
    .upload-section { margin-bottom: 20px; padding: 20px; background: rgba(0, 212, 255, 0.05); border-radius: 10px; border: 1px dashed var(--primary); text-align: center; }
    
    .selected-files { margin-top: 10px; text-align: right; font-size: 0.9rem; color: var(--text-muted); }

    .editor-container { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; padding: 20px; }
    .editor-area { width: 100%; height: calc(100% - 100px); background: #1a1a1a; color: #fff; font-family: monospace; padding: 20px; border-radius: 10px; border: 1px solid var(--primary); margin-bottom: 15px; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="logo">ğŸš€ AlliFF Bot Manager - Ø§Ù„Ù…Ù„ÙØ§Øª</div>
    <a href="/" class="btn btn-back">â¬…ï¸ Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  </header>

  <div class="container">
    <div class="manage-card">
      <div class="manage-card-title">
        <span id="folderTitle">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-danger" onclick="deleteAllFiles()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
          <button class="btn btn-primary" onclick="newFile()">ğŸ“„ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯</button>
        </div>
      </div>

      <div class="upload-section">
        <p style="margin-bottom: 10px; color: var(--primary);">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø±ÙØ¹Ù‡Ø§</p>
        <input type="file" id="fileUpload" multiple style="display: none;" onchange="updateFileList()">
        <button class="btn btn-manage" onclick="document.getElementById('fileUpload').click()">ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„ÙØ§Øª</button>
        <button class="btn btn-primary" id="uploadBtn" style="display: none;" onclick="uploadFiles()">ğŸ“¤ Ø¨Ø¯Ø¡ Ø§Ù„Ø±ÙØ¹</button>
        <div id="selectedFilesList" class="selected-files"></div>
      </div>

      <div id="fileList" class="file-list"></div>
    </div>
  </div>

  <div id="editorContainer" class="editor-container">
    <h3 id="editingFileName" style="margin-bottom: 15px; color: var(--primary);"></h3>
    <textarea id="fileEditor" class="editor-area"></textarea>
    <div style="display: flex; gap: 10px;">
      <button class="btn btn-primary" onclick="saveFile()">ğŸ’¾ Ø­ÙØ¸</button>
      <button class="btn btn-back" onclick="closeEditor()">âŒ Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const folder = urlParams.get('folder');
    if (!folder) window.location.href = '/';

    document.getElementById('folderTitle').textContent = `ğŸ“ Ù…Ù„ÙØ§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±: ${folder}`;

    async function loadFiles() {
      const res = await fetch(`/api/files/list/${folder}`);
      const files = await res.json();
      const list = document.getElementById('fileList');
      if (files.length === 0) {
        list.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª.</div>';
        return;
      }
      list.innerHTML = files.map(f => `
        <div class="file-item">
          <span>${f.is_dir ? 'ğŸ“' : 'ğŸ“„'} ${f.name} <small style="color: var(--text-muted); margin-right: 10px;">${f.is_dir ? '' : (f.size / 1024).toFixed(2) + ' KB'}</small></span>
          <div style="display: flex; gap: 10px;">
            ${!f.is_dir ? `<button class="btn btn-manage" style="padding: 5px 10px; font-size: 0.8rem;" onclick="editFile('${f.name}')">ğŸ“ ØªØ­Ø±ÙŠØ±</button>` : ''}
            <button class="btn btn-warning" style="padding: 5px 10px; font-size: 0.8rem;" onclick="renameFile('${f.name}')">âœï¸ ØªØ³Ù…ÙŠØ©</button>
            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;" onclick="deleteFile('${f.name}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
          </div>
        </div>
      `).join('');
    }

    function updateFileList() {
      const input = document.getElementById('fileUpload');
      const list = document.getElementById('selectedFilesList');
      const btn = document.getElementById('uploadBtn');
      if (input.files.length > 0) {
        list.textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${input.files.length} Ù…Ù„ÙØ§Øª`;
        btn.style.display = 'inline-block';
      } else {
        list.textContent = '';
        btn.style.display = 'none';
      }
    }

    async function uploadFiles() {
      const input = document.getElementById('fileUpload');
      if (input.files.length === 0) return;
      const formData = new FormData();
      for (let i = 0; i < input.files.length; i++) {
        formData.append('file', input.files[i]);
      }
      const res = await fetch(`/api/files/upload/${folder}`, { method: 'POST', body: formData });
      if ((await res.json()).success) {
        input.value = '';
        updateFileList();
        loadFiles();
      }
    }

    async function renameFile(oldName) {
      const newName = prompt('Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:', oldName);
      if (newName && newName !== oldName) {
        const res = await fetch(`/api/files/rename/${folder}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ old_name: oldName, new_name: newName })
        });
        if ((await res.json()).success) loadFiles();
      }
    }

    async function deleteAllFiles() {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹!')) return;
      const res = await fetch(`/api/files/delete_all/${folder}`, { method: 'POST' });
      if ((await res.json()).success) loadFiles();
    }

    async function deleteFile(filename) {
      if (!confirm(`Ø­Ø°Ù ${filename}ØŸ`)) return;
      const res = await fetch(`/api/files/delete/${folder}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filename })
      });
      if ((await res.json()).success) loadFiles();
    }

    async function editFile(name) {
      const res = await fetch(`/api/files/read/${folder}/${name}`);
      const data = await res.json();
      document.getElementById('editingFileName').textContent = 'ØªØ­Ø±ÙŠØ±: ' + name;
      document.getElementById('fileEditor').value = data.content;
      document.getElementById('editorContainer').style.display = 'block';
    }

    async function saveFile() {
      const filename = document.getElementById('editingFileName').textContent.replace('ØªØ­Ø±ÙŠØ±: ', '');
      const content = document.getElementById('fileEditor').value;
      const res = await fetch(`/api/files/save/${folder}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filename, content })
      });
      if ((await res.json()).success) { closeEditor(); loadFiles(); }
    }

    function closeEditor() { document.getElementById('editorContainer').style.display = 'none'; }
    function newFile() { const name = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯:'); if (name) editFile(name); }

    loadFiles();
  </script>
</body>
</html>
